<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enviar Fotos â€” Portal de Obras</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body data-page="upload">

  <!-- â”€â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <header class="header">
    <div class="header-inner">
      <a class="logo" href="index.html">
        <div class="logo-icon">ğŸ—ï¸</div>
        <div class="logo-info">
          <span class="logo-text">Portal de Obras</span>
          <span class="logo-sub">Envio de Fotos</span>
        </div>
      </a>
      <nav class="header-nav">
        <a href="index.html" class="btn btn-ghost">â† Dashboard</a>
        <button id="btnSettings" class="btn btn-white">âš™ ConfiguraÃ§Ãµes</button>
      </nav>
    </div>
  </header>

  <!-- â”€â”€â”€ HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <section class="hero">
    <div class="hero-inner">
      <div class="hero-left">
        <h1 class="hero-title">Envio de Fotos da Obra</h1>
        <p class="hero-sub">Selecione a obra, adicione a foto de capa e as fotos de andamento</p>
      </div>
    </div>
  </section>

  <!-- â”€â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <main class="main">

    <!-- Aviso se nÃ£o configurado -->
    <div id="uploadConfigWarn" style="display:none; margin-bottom:1.25rem">
      <div class="config-status warn">
        âš ï¸ &nbsp;RepositÃ³rio GitHub nÃ£o configurado.
        <button onclick="document.getElementById('btnSettings').click()"
          style="margin-left:8px;background:none;border:none;color:#c2410c;font-weight:700;cursor:pointer;text-decoration:underline">
          Configurar agora
        </button>
      </div>
    </div>

    <form id="uploadForm">
      <div class="upload-layout">

        <!-- â”€â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <aside class="sidebar-card">
          <div class="sidebar-card-title">ğŸ—ï¸ Selecionar Obra</div>

          <div class="form-group">
            <label class="form-label" for="obraSelect">Obra</label>
            <select class="form-input" id="obraSelect">
              <option value="">â€” Selecione a obra â€”</option>
            </select>
          </div>

          <div id="selectedObraName"
            style="font-size:.82rem;color:#1a4a8a;font-weight:600;min-height:20px;margin-bottom:1.25rem;padding:.5rem .75rem;background:#eff6ff;border-radius:8px;display:none">
          </div>

          <hr style="border:none;border-top:1px solid #e0eaf5;margin:1rem 0">

          <div style="font-size:.78rem;color:#5a7fa8;line-height:1.6">
            <p style="font-weight:700;color:#0d2d5e;margin-bottom:.5rem">ğŸ“‹ Regras de envio:</p>
            <p>â€¢ <strong>1 foto de capa</strong> por obra</p>
            <p>â€¢ AtÃ© <strong>18 fotos</strong> de andamento</p>
            <p>â€¢ Formatos: JPG, PNG, WEBP</p>
            <p>â€¢ Tamanho mÃ¡x: 25 MB por foto</p>
          </div>

          <hr style="border:none;border-top:1px solid #e0eaf5;margin:1rem 0">

          <button type="submit" class="btn btn-primary btn-lg" id="submitBtn"
            style="width:100%;justify-content:center">
            ğŸš€ Enviar Imagens
          </button>

          <!-- Barra de progresso -->
          <div class="upload-progress" id="uploadProgress">
            <div class="progress-bar">
              <div class="progress-fill" id="progressFill" style="width:0%"></div>
            </div>
            <div class="progress-text" id="progressText">Iniciando...</div>
          </div>

        </aside>

        <!-- â”€â”€â”€ ÃREA PRINCIPAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="upload-stack">

          <!-- CAPA -->
          <div class="upload-card">
            <div class="upload-card-title">
              ğŸ–¼ï¸ Foto de Capa
              <small>1 imagem â€” destaque da obra</small>
            </div>

            <div class="dropzone" id="capaDrop">
              <input type="file" id="capaInput" accept="image/jpeg,image/png,image/webp">
              <div class="dropzone-icon">ğŸ–¼ï¸</div>
              <div class="dropzone-text">
                <strong>Clique aqui</strong> ou arraste a foto de capa
              </div>
              <div class="dropzone-formats">JPG Â· PNG Â· WEBP</div>
            </div>

            <div class="preview-single" id="capaPreview" style="display:none">
              <!-- Preview injetado pelo JS -->
            </div>
          </div>

          <!-- ANDAMENTO -->
          <div class="upload-card">
            <div class="upload-card-title">
              ğŸ“· Fotos de Andamento
              <small id="progCount">0 / 18 selecionadas</small>
            </div>

            <div class="dropzone" id="progDrop">
              <input type="file" id="progInput" accept="image/jpeg,image/png,image/webp" multiple>
              <div class="dropzone-icon">ğŸ“·</div>
              <div class="dropzone-text">
                <strong>Clique aqui</strong> ou arraste as fotos de andamento
              </div>
              <div class="dropzone-formats">
                Selecione atÃ© 18 fotos &nbsp;Â·&nbsp; JPG Â· PNG Â· WEBP
              </div>
            </div>

            <div class="preview-grid" id="progPreview">
              <!-- Previews injetados pelo JS -->
            </div>
          </div>

        </div>
        <!-- fim upload-stack -->

      </div>
      <!-- fim upload-layout -->
    </form>

  </main>

  <!-- â”€â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <footer class="footer">
    Portal de Imagens de Obras &nbsp;Â·&nbsp; Ãrea de Envio
  </footer>

  <!-- â”€â”€â”€ MODAL DE CONFIGURAÃ‡Ã•ES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="modal-overlay" id="settingsModal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">âš™ ConfiguraÃ§Ã£o do RepositÃ³rio GitHub</div>
        <button class="modal-close" id="closeSettings">âœ•</button>
      </div>
      <div id="cfgStatus" class="config-status warn">
        âš ï¸ &nbsp;Configure o repositÃ³rio GitHub para habilitar uploads
      </div>
      <form id="settingsForm">
        <div class="form-group">
          <label class="form-label" for="inOwner">UsuÃ¡rio ou OrganizaÃ§Ã£o GitHub</label>
          <input class="form-input" id="inOwner" type="text" placeholder="ex: minha-empresa" autocomplete="off">
        </div>
        <div class="form-group">
          <label class="form-label" for="inRepo">Nome do RepositÃ³rio</label>
          <input class="form-input" id="inRepo" type="text" placeholder="ex: portal-obras-imagens" autocomplete="off">
        </div>
        <div class="form-group">
          <label class="form-label" for="inToken">
            Token de Acesso Pessoal (PAT)
            <span> â€” necessÃ¡rio para uploads</span>
          </label>
          <input class="form-input" id="inToken" type="password" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" autocomplete="off">
          <div class="form-hint">
            Gere em: GitHub â†’ Settings â†’ Developer settings â†’ Personal access tokens<br>
            PermissÃ£o necessÃ¡ria: <strong>Contents: Read &amp; Write</strong>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label" for="inBranch">Branch <span>(padrÃ£o: main)</span></label>
          <input class="form-input" id="inBranch" type="text" placeholder="main" value="main">
        </div>
        <div class="form-actions" style="flex-wrap:wrap;gap:.5rem">
          <button type="button" class="btn" style="background:#f1f5f9;color:#555"
            onclick="document.getElementById('settingsModal').classList.remove('open')">Cancelar</button>
          <button type="button" class="btn" style="background:#eff6ff;color:#1d4ed8;border:1px solid #bfdbfe"
            onclick="generateSetupLink()">
            ğŸ”— Gerar Link para Engenheiros
          </button>
          <button type="submit" class="btn btn-primary">Salvar e Verificar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="toast" id="toast"></div>

  <!-- â”€â”€â”€ SCRIPTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <script src="js/config.js"></script>
  <script src="js/github-api.js"></script>
  <script src="js/app.js"></script>
  <script>
    // Mostrar nome da obra selecionada no sidebar
    document.addEventListener('DOMContentLoaded', () => {
      const sel  = document.getElementById('obraSelect');
      const name = document.getElementById('selectedObraName');
      if (!sel || !name) return;
      sel.addEventListener('change', () => {
        if (sel.value) {
          name.style.display = '';
        } else {
          name.style.display = 'none';
        }
      });
    });
  </script>

</body>
</html>
